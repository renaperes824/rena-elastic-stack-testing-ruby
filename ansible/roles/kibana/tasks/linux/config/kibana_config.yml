#-----------------------------------------------------------------------------------------------------------------------
# Configure kibana on Linux
#
# Set certain parameters in kibana configuration
#
# Author: liza.dayoub@elastic.co
#-----------------------------------------------------------------------------------------------------------------------

---

- name: Add network host
  lineinfile:
    path: '{{ kibana_config_file }}'
    insertafter: '^#server.host:'
    line: 'server.host: {{ network_host }}'
  become: '{{ kibana_run_as_root | default(omit) }}'
  when: network_host is defined

- name: Add logging
  lineinfile:
    path: "{{ kibana_config_file }}"
    insertafter: '^#logging.dest:'
    line: 'logging.dest: {{ kibana_log_file | trim }}'
  become: '{{ kibana_run_as_root | default(omit) }}'

- name: Create log directory
  file:
    path: '{{ kibana_log_dir }}'
    state: directory
    mode: 0777
  become: true
  tags: kibana_log_check
